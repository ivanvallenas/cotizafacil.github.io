<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/main_elements.css">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
    <link rel="stylesheet" type="text/css" href="css/crear_cuenta_ferreteria.css">



    

    <title>Cotiza Fácil</title>
    <div class="container">
        <img alt="Logo" height="180px" width="320px" src="https://dsm01pap006files.storage.live.com/y4mNYSblU15eU4-_GqQ1mLll3h9vDL3Qk3rTrnG_-8m3kNnvIn2gjgn2JuUKP_-8IH6CZMMh5DaPqqCC1YwrBuHe8YQg4oWtN8O63r0LJn27is8XCqJY8t9T-zheYsrHZku3NQKONZJroyD7AEoQHiA1ppCPL9MavGXXowQ1vuLeot--2DBaSgkbv7W1eqjrFGz?width=494&height=231&cropmode=none">
    </div>
</head>


<body>

    <section class="container">

    
        <container class="container_form">
            <h1 class="Title">Crear una cuenta</h1>

            <input class="item_form" placeholder="Nombre de tu ferreteria" type="text" id="nombre_ferreteria">

            <input class="item_form" placeholder="Dirección" type="text" id="direccion">

            <div>
                <select id="prefijo_pais"><option value="591">BOL+591</option><option value="51">PER+51</option></select>
                <input class="item_form" placeholder="Teléfono" type="text" id="telefono">
            </div>



            <input class="item_form" placeholder="Correo" id="email" type="email">
  
            <input class="item_form" placeholder="Nueva Contraseña" id="password" type="password">

        

            <button id="registrar_usuario">Registrar</button>          
        </container>

    </section>


    <script type="module">
        import {app} from "./js/firebase.js"; 
        import {db} from "./js/firebase.js"; 
        import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, onAuthStateChanged,signInWithPopup, getRedirectResult, getAdditionalUserInfo } 
        from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import {getDatabase,set, get, update, remove, ref, child}
        from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"
        const auth = getAuth();

        registrar_usuario.addEventListener('click',(e)=>{
            var nombre_ferreteria = document.getElementById("nombre_ferreteria").value;
            var direccion = document.getElementById("direccion").value;
            var prefijo_pais = document.getElementById("prefijo_pais").value; 
            var telefono = document.getElementById("telefono").value;   
            var email = document.getElementById("email").value;
            var password = document.getElementById("password").value;

            createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {

                const user = userCredential.user;
                const usuario = user.uid
                sessionStorage.setItem("usuario",usuario)
                sessionStorage.setItem("nombre",nombre_ferreteria)
                sessionStorage.setItem("prefijo_pais",prefijo_pais)
                sessionStorage.setItem("telefono",telefono)
                sessionStorage.setItem("direccion",direccion)

                localStorage.setItem("email",email)
                localStorage.setItem("password",password)

                console.log(usuario)

                set(ref(db, "ferreterias/"+usuario),{
                        uid: usuario,
                        nombre: nombre_ferreteria,
                        direccion: direccion,
                        prefijo_pais: prefijo_pais,
                        telefono: telefono,
                        Entregas: "si",
                })

                let ferreteria_materiales = []
                let ferreteria_marcas = []
                let ferreteria_pruductos = []
                let ferreteria_precios = []
                const num_materiales = 10

                for(var i=0;i<num_materiales-1;i++){
                    set(ref(db, "ferreterias/"+usuario+"/materiales/material"+(i+1)+"/material"),"Elegir material")
                    set(ref(db, "ferreterias/"+usuario+"/materiales/material"+(i+1)+"/marca"),"Elegir marca")
                    set(ref(db, "ferreterias/"+usuario+"/materiales/material"+(i+1)+"/precio"),0)
                    ferreteria_materiales.push("Elegir material")
                    ferreteria_marcas.push("Elegir marca")
                    ferreteria_pruductos.push("Elegir materialElegir marca")
                    ferreteria_precios.push(0)
                }

                set(ref(db, "ferreterias/"+usuario+"/materiales/material"+num_materiales+"/material"),"Elegir material")
                set(ref(db, "ferreterias/"+usuario+"/materiales/material"+num_materiales+"/marca"),"Elegir marca")
                ferreteria_materiales.push("Elegir material")
                ferreteria_marcas.push("Elegir marca")
                ferreteria_pruductos.push("Elegir materialElegir marca")
                ferreteria_precios.push(0)
                sessionStorage.setItem("ferreteria_pruductos",JSON.stringify(ferreteria_pruductos))
                sessionStorage.setItem("ferreteria_precios",JSON.stringify(ferreteria_precios))
                sessionStorage.setItem("ferreteria_materiales",JSON.stringify(ferreteria_materiales))
                sessionStorage.setItem("ferreteria_marcas",JSON.stringify(ferreteria_marcas))
                set(ref(db, "ferreterias/"+usuario+"/materiales/material"+num_materiales+"/precio"),0).then(() => {window.location.href = "lista_materiales.html"})

            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
            });   
        })
        console.log(sessionStorage.getItem("ferreteria_marcas"))
    </script>
</body>
</html>