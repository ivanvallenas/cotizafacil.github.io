<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotiza Fácil</title>
    <link rel="stylesheet" type="text/css" href="css/lista_solicitudes.css">
    <link rel="stylesheet" type="text/css" href="css/main_elements.css">

</head>
<body>

    <section class="container">

        <div id="btns_de_listas" >
            <button id="lista_solicitudes" class="main_buttons" onclick="window.location='lista_solicitudes.html'"" style="background-color:rgb(106, 106, 126)">Cotizar</button>
            <button id="lista_cotizaciones_realizadas" class="main_buttons"  onclick="window.location='lista_cotizaciones.html'"">Tus Ofertas</button>
            <button id="lista_materiales" class="main_buttons"  onclick="window.location='lista_materiales.html'"">Tus Materiales</button>

        </div>

        <div id="titulos_tabla_principal" class="titulos_tabla">
            <a>Código</a>
            <a>Pedido</a>
            <a>Monto</a>
        </div>

        <div id="botones" class="container"></div>
    </section>

   

    <script type="module">

       

        //Import the database and the principal functions
        import {db} from "./js/firebase.js";   
        import {getDatabase,query, set, get, update, remove, ref, child,onValue}
        from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"
        //Get only the requests of quotes from the database  
        const parte = query(ref(db,'Solicitudes'))
        //Define a varible that makes reference to the div where all the quotes request are going to apear
        var btncon = document.getElementById("botones")
        const usuario = sessionStorage.getItem("usuario")

        console.log(JSON.parse(sessionStorage.getItem("ferreteria_pruductos")))

        let ferreteria_pruductos = []
        ferreteria_pruductos =JSON.parse(sessionStorage.getItem("ferreteria_pruductos"))

        let ferreteria_precios = []
        ferreteria_precios =JSON.parse(sessionStorage.getItem("ferreteria_precios"))

        console.log(usuario)


 
        
        function valor_de_material(material){
            for(var i=0; i<ferreteria_pruductos.length;i++){
                if(ferreteria_pruductos[i]==material){
                    return(ferreteria_precios[i])
                    console.log("lollll")
                }else{
                    console.log("kkkkk")
                }
            }
        }
       
        
        //function to show all the quotes and refresh when a change in the db apears
        onValue(parte, (snapshot) => {
            //first we delete everything inside the div
            btncon.replaceChildren()
            //a snapshot of the data base is created in order to get the data to build the html for each quote request and one expandible element is created for each quote request
            snapshot.forEach((childSnapshot) => {
                //
                var empresa = document.createElement("div")
                var cbt = document.createElement("div")
                var precio = document.createElement("div")
                var pedido = document.createElement("div")
                var ppp = childSnapshot.val().marca1
                console.log(childSnapshot.val().material1+childSnapshot.val().marca1)

                cbt.className="collapsible"

                empresa.className="item"
                empresa.innerHTML=childSnapshot.key

                pedido.className="item"
                pedido.innerHTML=childSnapshot.val().material1

                precio.className="item"
                precio.innerHTML=childSnapshot.val().marca1
                        

                cbt.appendChild(empresa)
                cbt.appendChild(pedido)
                cbt.appendChild(precio)
                btncon.appendChild(cbt)

                        
                var content = document.createElement("div")
                content.className="content"

                var tabla = document.createElement("div")
                tabla.className="table"

                var titulo1 = document.createElement("div")
                titulo1.className="titulo_columna"
                var titulo1_t = document.createElement("p")
                titulo1_t.innerHTML="Material"
                titulo1.appendChild(titulo1_t)
                tabla.appendChild(titulo1)

                var titulo2 = document.createElement("div")
                titulo2.className="titulo_columna"
                var titulo2_t = document.createElement("p")
                titulo2_t.innerHTML="Marca"
                titulo2.appendChild(titulo2_t)
                tabla.appendChild(titulo2)
        
                var titulo3 = document.createElement("div")
                titulo3.className="titulo_columna"
                var titulo3_t = document.createElement("p")
                titulo3_t.innerHTML="Cantidad"
                titulo3.appendChild(titulo3_t)
                tabla.appendChild(titulo3)

                var titulo4 = document.createElement("div")
                titulo4.className="titulo_columna"
                var titulo4_t = document.createElement("p")
                titulo4_t.innerHTML="Precio"
                titulo4.appendChild(titulo4_t)
                tabla.appendChild(titulo4)

                        
                var m1 = document.createElement("div")
                m1.className="item"
                m1.innerHTML=childSnapshot.val().material1
                tabla.appendChild(m1)

                var ma1 = document.createElement("div")
                ma1.className="item"
                ma1.innerHTML=childSnapshot.val().marca1
                tabla.appendChild(ma1)

                var ca1 = document.createElement("div")
                ca1.className="item"
                ca1.innerHTML=childSnapshot.val().cantidad1
                tabla.appendChild(ca1)

                var p1 = document.createElement("input")
                p1.className="quantity_box"
                p1.value=valor_de_material(childSnapshot.val().material1+childSnapshot.val().marca1)
                tabla.appendChild(p1)


                var m2 = document.createElement("div")
                m2.className="item"
                m2.innerHTML=childSnapshot.val().material2
                tabla.appendChild(m2)

                var ma2 = document.createElement("div")
                ma2.className="item"
                ma2.innerHTML=childSnapshot.val().marca2
                tabla.appendChild(ma2)

                var ca2 = document.createElement("div")
                ca2.className="item"
                ca2.innerHTML=childSnapshot.val().cantidad2
                tabla.appendChild(ca2)


                content.appendChild(tabla)

                var button_cotizar = document.createElement("button")
                button_cotizar.className="main_buttons"
                button_cotizar.innerHTML="COTIZAR"
                content.appendChild(button_cotizar)


                btncon.appendChild(content)






            });
            //This code is for only show the elements with class "content" when the elements with class "expandible" are clicked
            var coll = document.getElementsByClassName("collapsible");
            var i;
            for (i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.display === "block") {
                    content.style.display = "none";
                    } else {
                    content.style.display = "block";
                    }
                });
            }        
        },)
    </script>
    

</body>
</html>