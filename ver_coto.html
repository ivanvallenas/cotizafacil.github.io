<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotiza Fácil</title>
    <link rel="stylesheet" type="text/css" href="css/lista_solicitudes.css">
    <link rel="stylesheet" type="text/css" href="css/main_elements.css">

</head>
<body>

    <section class="container2">

        <div id="titulos_tabla_principal" class="titulos_tabla">
            <a>Ferretería</a>
            <a>Pedido</a>
            <a>Precio total </a>
        </div>

        <div id="botones" class="container2"></div>
    </section>

   

    <script type="module">

       

        //Import the database and the principal functions
        import {db} from "./js/firebase.js";   
        import {getDatabase,query, set, get, update, remove, ref, child,onValue}
        from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"
        //Get only the requests of quotes from the database  

        const codigo_solicitud = sessionStorage.getItem("codigo_solicitud")
        const parte = query(ref(db,'Solicitudes/'+codigo_solicitud+"/Cotizaciones"))
  



        //Define a varible that makes reference to the div where all the quotes request are going to apear
        var btncon = document.getElementById("botones")
        const usuario = sessionStorage.getItem("usuario")

        console.log(JSON.parse(sessionStorage.getItem("ferreteria_pruductos")))
        console.log(JSON.parse(sessionStorage.getItem("ferreteria_precios")))

        let ferreteria_pruductos = []
        ferreteria_pruductos =JSON.parse(sessionStorage.getItem("ferreteria_pruductos"))

        let ferreteria_precios = []
        ferreteria_precios =JSON.parse(sessionStorage.getItem("ferreteria_precios"))
      
        
        //function to show all the quotes and refresh when a change in the db apears
        onValue(parte, (snapshot) => {
            //first we delete everything inside the div
            btncon.replaceChildren()
            //a snapshot of the data base is created in order to get the data to build the html for each quote request and one expandible element is created for each quote request
            snapshot.forEach((childSnapshot) => {
            

    
                
                
                
                var empresa = document.createElement("div")
                var cbt = document.createElement("div")
                var precio = document.createElement("div")
                var pedido = document.createElement("div")
                var ppp = childSnapshot.val().marca1

                cbt.className="collapsible"

                empresa.className="item"
                empresa.innerHTML=childSnapshot.val().nombre

                pedido.className="item"
                pedido.innerHTML=childSnapshot.val().pedido

                precio.className="item"
                precio.innerHTML=childSnapshot.val().precio_total


                        

                cbt.appendChild(empresa)
                cbt.appendChild(pedido)
                cbt.appendChild(precio)
                btncon.appendChild(cbt)


                var content = document.createElement("div")
                content.className="content"
                var material_marca1 = document.createElement("div")
                material_marca1.className="item2"
                var material_marca2 = document.createElement("div")
                material_marca2.className="item2"
                var material_marca3 = document.createElement("div")
                material_marca3.className="item2"
                var material_marca4 = document.createElement("div")
                material_marca4.className="item2"
                var material_marca5 = document.createElement("div")
                material_marca5.className="item2"
                

                
                        
                var content = document.createElement("div")
                content.className="content"

                var tabla = document.createElement("div")
                tabla.className="table"

                var titulo1 = document.createElement("div")
                titulo1.className="titulo_columna"
                var titulo1_t = document.createElement("p")
                titulo1_t.innerHTML="Material y marca"
                titulo1.appendChild(titulo1_t)
                tabla.appendChild(titulo1)
        
                var titulo3 = document.createElement("div")
                titulo3.className="titulo_columna"
                var titulo3_t = document.createElement("p")
                titulo3_t.innerHTML="Unid"
                titulo3.appendChild(titulo3_t)
                tabla.appendChild(titulo3)

                var titulo4 = document.createElement("div")
                titulo4.className="titulo_columna"
                var titulo4_t = document.createElement("p")
                titulo4_t.innerHTML="Precio"
                titulo4.appendChild(titulo4_t)
                tabla.appendChild(titulo4)

                        
                var m1 = document.createElement("div")
                m1.innerHTML=childSnapshot.val().material1
                material_marca1.appendChild(m1)

                var ma1 = document.createElement("div")
                ma1.innerHTML=childSnapshot.val().marca1
                material_marca1.appendChild(ma1)

                tabla.appendChild(material_marca1)

                var ca1 = document.createElement("div")
                ca1.className="item"
                ca1.innerHTML=childSnapshot.val().cantidad1
                tabla.appendChild(ca1)



                var p1 = document.createElement("div")
                p1.className="item"
                if(childSnapshot.val().material1==" "){ p1.className="item5" }
                p1.innerHTML=childSnapshot.val().precio1
                tabla.appendChild(p1)


                var m2 = document.createElement("div")
                m2.innerHTML=childSnapshot.val().material2
                material_marca2.appendChild(m2)

                var ma2 = document.createElement("div")
                ma2.innerHTML=childSnapshot.val().marca2
                material_marca2.appendChild(ma2)

                tabla.appendChild(material_marca2)

                var ca2 = document.createElement("div")
                ca2.className="item"
                ca2.innerHTML=childSnapshot.val().cantidad2
                tabla.appendChild(ca2)

                var p2 = document.createElement("div")
                p2.className="item"
                if(childSnapshot.val().material2==" "){ p2.className="item5" }
                p2.innerHTML=childSnapshot.val().precio2
                tabla.appendChild(p2)



                var m3 = document.createElement("div")
                m3.innerHTML=childSnapshot.val().material3
                material_marca3.appendChild(m3)

                var ma3 = document.createElement("div")
                ma3.innerHTML=childSnapshot.val().marca3
                material_marca3.appendChild(ma3)

                tabla.appendChild(material_marca3)

                var ca3 = document.createElement("div")
                ca3.className="item"
                ca3.innerHTML=childSnapshot.val().cantidad3
                tabla.appendChild(ca3)

                var p3 = document.createElement("div")
                p3.className="item"
                if(childSnapshot.val().material3==" "){ p3.className="item5" }
                p3.innerHTML=childSnapshot.val().precio3
                tabla.appendChild(p3)



                var m4 = document.createElement("div")
                m4.innerHTML=childSnapshot.val().material4
                material_marca4.appendChild(m4)

                var ma4 = document.createElement("div")
                ma4.innerHTML=childSnapshot.val().marca4
                material_marca4.appendChild(ma4)

                tabla.appendChild(material_marca4)

                var ca4 = document.createElement("div")
                ca4.className="item"
                ca4.innerHTML=childSnapshot.val().cantidad4
                tabla.appendChild(ca4)

                var p4 = document.createElement("div")
                p4.className="item"
                if(childSnapshot.val().material4==" "){ p4.className="item5" }
                p4.innerHTML=childSnapshot.val().precio4
                tabla.appendChild(p4)


                var m5 = document.createElement("div")
                m5.innerHTML=childSnapshot.val().material5
                material_marca5.appendChild(m5)

                var ma5 = document.createElement("div")
                ma5.innerHTML=childSnapshot.val().marca5
                material_marca5.appendChild(ma5)

                tabla.appendChild(material_marca5)

                var ca5 = document.createElement("div")
                ca5.className="item"
                ca5.innerHTML=childSnapshot.val().cantidad5
                tabla.appendChild(ca5)

                var p5 = document.createElement("div")
                p5.className="item"
                if(childSnapshot.val().material5==" "){ p5.className="item5" }
                p5.innerHTML=childSnapshot.val().precio5
                tabla.appendChild(p5)

                content.appendChild(tabla)

                var telefono = document.createElement("div")
                telefono.className="item3"
                telefono.innerHTML="Teléfono: "+childSnapshot.val().telefono
                content.appendChild(telefono)

                var direccion = document.createElement("div")
                direccion.className="item3"
                direccion.innerHTML="Dirección: "+childSnapshot.val().direccion
                content.appendChild(direccion)





                var button_cotizar = document.createElement("button")
                button_cotizar.className="main_buttons2"
                button_cotizar.innerHTML="Descargar cotización"
                content.appendChild(button_cotizar)
                button_cotizar.addEventListener("click",function(){


                })


                btncon.appendChild(content)







            });
            //This code is for only show the elements with class "content" when the elements with class "collapsible" are clicked
            var coll = document.getElementsByClassName("collapsible");
            var i;
            for (i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.display === "flex") {
                    content.style.display = "none";
                    } else {
                    content.style.display = "flex";
                    }
                    var valor_total = this.getElementsByClassName("item");
                    var pp = valor_total[2].textContent
                    console.log(pp)
                });
            }    
            

            


        },)
    </script>
    

</body>
</html>