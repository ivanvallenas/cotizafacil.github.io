<!DOCTYPE html>
<html>
<head>

<script>






function calculo_ganacias_datos(buys,sales){
  let compras={}
  let ventas={}
  let total_compras={}
  let total_ventas={}
  let ganancia={}
  let total_costo_venta={}
  let inventario_actual={}
  let inventario_actual_valor={}

  function lista_compras(stock,num_compras,costo){
    if (!compras[stock]) {
      inventario_actual[stock]=0
      total_compras[stock]=0
      ganancia[stock]=0
      total_costo_venta[stock]=0
      inventario_actual_valor[stock]=0
      compras[stock] = [] }
    for(var i=0;i<num_compras;i++){
      compras[stock].push(costo)
      total_compras[stock]=total_compras[stock]+costo
    }
  }

  function lista_ventas(stock,num_ventas,precio){
    if (!ventas[stock]) {
      ventas[stock] = []
      total_ventas[stock]=0
     }
    for(var i=0;i<num_ventas;i++){
      ventas[stock].push(precio)
      total_ventas[stock]=total_ventas[stock]+precio
    }
  }

  for(let i = 0; i < sales.length; i++){lista_ventas(sales[i].stock,sales[i].quantity,sales[i].price)}
  for(let i = 0; i < buys.length; i++){lista_compras(buys[i].stock,buys[i].quantity,buys[i].price)}

  for(key in compras){
    if(!ventas[key]){num_ventas = 0}else{num_ventas=ventas[key].length}
    inventario_actual[key]=compras[key].length-num_ventas
    for(var i=0;i<Math.min(compras[key].length,ventas[key].length);i++){
      ganancia[key]=ganancia[key]+ventas[key][i]-compras[key][i]
      total_costo_venta[key]= total_costo_venta[key]+compras[key][i]
    }
    if(inventario_actual[key]<=0){inventario_actual_valor[key]=0}else{inventario_actual_valor[key]=total_compras[key]-total_costo_venta[key]}
  }

  return({inventario_actual,total_compras,total_ventas,ganancia,total_costo_venta,inventario_actual_valor})
}

let prueba = {}


const buys = [
  {date: '2022-03-01', price: 100, quantity: 2, stock: 'AAPL'},
  {date: '2022-03-01', price: 101, quantity: 3, stock: 'AAPL'},
  {date: '2022-03-01', price: 101, quantity: 5, stock: 'ppp'},

];
const sales = [
  {date: '2022-06-01', price: 100, quantity: 10, stock: 'AAPL'},
  {date: '2022-06-01', price: 102, quantity: 10, stock: 'AAPL'},
  {date: '2022-06-01', price: 102, quantity: 10, stock: 'ppp'},

]

console.log(buys)

pp=calculo_ganacias_datos(buys,sales)
console.log(pp)


</script>
</head>
</body>
</html>